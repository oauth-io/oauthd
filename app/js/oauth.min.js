(function(){"use strict";function a(e){if(e.match(/^.{2,5}:\/\//))return e;if(e[0]==="/")return document.location.protocol+"//"+document.location.host+e;var t=document.location.protocol+"//"+document.location.host+document.location.pathname;if(t[t.length-1]!="/"&&e[0]!="#")return t+"/"+e;return t+e}function f(e,t,n){e=e.replace(/\{\{(.*?)\}\}/g,function(e,n){return t[n]||""});if(n)e=e.replace(/\{(.*?)\}/g,function(e,t){return n[t]||""});return e}function l(e,t,n,r){return function(i,s){var o={};if(typeof i==="string"){if(typeof s==="object")for(var u in s){o[u]=s[u]}o.url=i}else if(typeof i==="object")for(var u in i){o[u]=i[u]}o.type=o.type||r;o.oauthio={provider:e,tokens:t,request:n};return OAuth.http(o)}}function c(e){var t;var n;try{t=JSON.parse(e.data)}catch(r){return e.callback(new Error("Error while parsing result"))}if(!t||!t.provider)return;if(e.provider&&t.provider.toLowerCase()!==e.provider.toLowerCase())return;if(t.status==="error"||t.status==="fail"){n=new Error(t.message);if(t.data)n.body=t.data;return e.callback(n)}if(t.status!=="success"||!t.data){n=new Error;n.body=t.data;return e.callback(n)}if(!t.state||o.indexOf(t.state)==-1)return e.callback(new Error("State is not matching"));if(!e.provider)t.data.provider=t.provider;var i=t.data;if(d(e.cache)&&i)p(t.provider,i);var s=i.request;delete i.request;var u;if(i.access_token)u={access_token:i.access_token};else if(i.oauth_token&&i.oauth_token_secret)u={oauth_token:i.oauth_token,oauth_token_secret:i.oauth_token_secret};if(!s)return e.callback(null,i);if(s.required)for(var a in s.required)u[s.required[a]]=i[s.required[a]];var f=function(e){return l(t.provider,u,s,e)};i.get=f("GET");i.post=f("POST");i.put=f("PUT");i.patch=f("PATCH");i.del=f("DELETE");return e.callback(null,i)}function h(e,t){if(d(t)){t=y("oauthio_provider_"+e);if(!t)return false;t=decodeURIComponent(t)}if(typeof t==="string"){try{t=JSON.parse(t)}catch(n){return false}}if(typeof t==="object"){var r={};for(var i in t)if(i!=="request"&&typeof t[i]!=="function")r[i]=t[i];return OAuth.create(e,r,t.request)}return false}function p(e,t){console.log("store",e,encodeURIComponent(JSON.stringify(t)),t.expires_in);g("oauthio_provider_"+e,encodeURIComponent(JSON.stringify(t)),t.expires_in-10||3600)}function d(t){if(typeof t==="undefined")return e.options.cache;return t}function v(t){function i(e,t,n){if(r[e]){var i=r[e];delete r[e];for(var s in i)i[s](t,n)}}function s(r){if(n[r])return;n[r]=true;t.ajax({url:e.oauthd_url+e.oauthd_api+"/providers/"+r,data:{extend:true},dataType:"json"}).done(function(e){n[r]=e.data;i(r,null,e.data)}).always(function(){if(typeof n[r]!=="object"){delete n[r];i(r,new Error("Unable to fetch request description"))}})}function p(e,t,i){t=t||{};if(typeof n[e]==="object")return i(null,n[e]);if(!n[e])s(e);if(!t.wait)return i(null,{});r[e]=r[e]||[];r[e].push(i)}var n={};var r={};window.OAuth={initialize:function(t,n){e.key=t;if(n)for(var r in n)e.options[r]=n[r]},setOAuthdURL:function(t){e.oauthd_url=t;e.oauthd_base=a(e.oauthd_url).match(/^.{2,5}:\/\/[^/]+/)[0]},getVersion:function(){return e.version},create:function(e,t,n){if(!t)return h(e,true);if(typeof n!=="object")s(e);var r=function(r){return l(e,t,n,r)};var i={};for(var o in t)i[o]=t[o];i.get=r("GET");i.post=r("POST");i.put=r("PUT");i.patch=r("PATCH");i.del=r("DELETE");return i},popup:function(t,n,r){function v(t){if(t.origin!==e.oauthd_base)return;try{i.close()}catch(t){}n.data=t.data;return c(n)}var i,s;if(!e.key)return r(new Error("OAuth object must be initialized"));if(arguments.length==2){r=n;n={}}if(d(n.cache)){var u=h(t,n.cache);if(u)return r(null,u)}if(!n.state){n.state=m();n.state_type="client"}o.push(n.state);var f=e.oauthd_url+"/auth/"+t+"?k="+e.key;f+="&d="+encodeURIComponent(a("/"));if(n)f+="&opts="+encodeURIComponent(JSON.stringify(n));var l={width:Math.floor(window.outerWidth*.8),height:Math.floor(window.outerHeight*.5)};if(l.height<350)l.height=350;if(l.width<800)l.width=800;l.left=window.screenX+(window.outerWidth-l.width)/2;l.top=window.screenY+(window.outerHeight-l.height)/8;var p="width="+l.width+",height="+l.height;p+=",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0";p+=",left="+l.left+",top="+l.top;n={provider:t,cache:n.cache};n.callback=function(e,t){if(window.removeEventListener)window.removeEventListener("message",v,false);else if(window.detachEvent)window.detachEvent("onmessage",v);else if(document.detachEvent)document.detachEvent("onmessage",v);n.callback=function(){};return r(e,t)};if(window.attachEvent)window.attachEvent("onmessage",v);else if(document.attachEvent)document.attachEvent("onmessage",v);else if(window.addEventListener)window.addEventListener("message",v,false);if(!s&&(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0)){s=document.createElement("iframe");s.src=e.oauthd_url+"/auth/iframe?d="+encodeURIComponent(a("/"));s.width=0;s.height=0;s.frameBorder=0;s.style.visibility="hidden";document.body.appendChild(s)}setTimeout(function(){n.callback(new Error("Authorization timed out"))},600*1e3);i=window.open(f,"Authorization",p);if(i)i.focus()},redirect:function(t,n,r){if(arguments.length==2){r=n;n={}}if(d(n.cache)){var i=h(t,n.cache);if(i){r=a(r)+(r.indexOf("#")===-1?"#":"&")+"oauthio=cache";document.location.href=r;document.location.reload();return}}if(!n.state){n.state=m();n.state_type="client"}g("oauthio_state",n.state);var s=encodeURIComponent(a(r));r=e.oauthd_url+"/auth/"+t+"?k="+e.key;r+="&redirect_uri="+s;if(n)r+="&opts="+encodeURIComponent(JSON.stringify(n));document.location.href=r},callback:function(e,t,n){if(arguments.length==1){n=e;e=undefined;t={}}if(arguments.length==2){n=t;t={}}if(d(t.cache)||u==="cache"){if(u==="cache"&&(typeof e!=="string"||!e))return n(new Error("You must set a provider when using the cache"));var r=h(e,t.cache);if(r)return n(null,r)}if(!u)return;c({data:u,provider:e,cache:t.cache,callback:n})},http:function(n){function u(){var n=r.oauthio.request||{};if(!n.cors){r.url=encodeURIComponent(r.url);if(r.url[0]!="/")r.url="/"+r.url;r.url=e.oauthd_url+"/request/"+r.oauthio.provider+r.url;r.headers=r.headers||{};r.headers.oauthio="k="+e.key;if(r.oauthio.tokens.oauth_token&&r.oauthio.tokens.oauth_token_secret)r.headers.oauthio+="&oauthv=1";for(var s in r.oauthio.tokens)r.headers.oauthio+="&"+encodeURIComponent(s)+"="+encodeURIComponent(r.oauthio.tokens[s]);delete r.oauthio;return t.ajax(r)}if(r.oauthio.tokens){if(r.oauthio.tokens.access_token)r.oauthio.tokens.token=r.oauthio.tokens.access_token;if(!r.url.match(/^[a-z]{2,16}:\/\//)){if(r.url[0]!=="/")r.url="/"+r.url;r.url=n.url+r.url}r.url=f(r.url,r.oauthio.tokens,n.parameters);if(n.query){var o=[];for(i in n.query)o.push(encodeURIComponent(i)+"="+encodeURIComponent(f(n.query[i],r.oauthio.tokens,n.parameters)));o=o.join("&");if(r.url.indexOf("?")!==-1)r.url+="&"+o;else r.url+="?"+o}if(n.headers){r.headers=r.headers||{};for(i in n.headers)r.headers[i]=f(n.headers[i],r.oauthio.tokens,n.parameters)}delete r.oauthio;return t.ajax(r)}}var r={};var i;for(i in n){r[i]=n[i]}if(!r.oauthio.request||r.oauthio.request===true){var s={wait:!!r.oauthio.request};var o=t.Deferred();p(r.oauthio.provider,s,function(e,t){if(e)return o.reject(e);if(r.oauthio.tokens.oauth_token&&r.oauthio.tokens.oauth_token_secret)r.oauthio.request=t.oauth1&&t.oauth1.request;else r.oauthio.request=t.oauth2&&t.oauth2.request;o.resolve()});return o.then(u)}else return u()},clearCache:function(e){b("oauthio_provider_"+e)}}}function m(){var e=x((new Date).getTime()+":"+Math.floor(Math.random()*9999999));return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function g(e,t,n){b(e);var r=new Date;r.setTime(r.getTime()+(n*1e3||6e5));var n="; expires="+r.toGMTString();document.cookie=e+"="+t+n+"; path=/"}function y(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)===" ")i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null}function b(e){var t=new Date;t.setTime(t.getTime()-864e5);document.cookie=e+"=; expires="+t.toGMTString()+"; path=/"}function S(e){return M(A(P(e)))}function x(e){return _(A(P(e)))}function T(e,t){return D(A(P(e)),t)}function N(e,t){return M(O(P(e),P(t)))}function C(e,t){return _(O(P(e),P(t)))}function k(e,t,n){return D(O(P(e),P(t)),n)}function L(){return S("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function A(e){return F(I(j(e),e.length*8))}function O(e,t){var n=j(e);if(n.length>16)n=I(n,e.length*8);var r=Array(16),i=Array(16);for(var s=0;s<16;s++){r[s]=n[s]^909522486;i[s]=n[s]^1549556828}var o=I(r.concat(j(t)),512+t.length*8);return F(I(i.concat(o),512+160))}function M(e){try{w}catch(t){w=0}var n=w?"0123456789ABCDEF":"0123456789abcdef";var r="";var i;for(var s=0;s<e.length;s++){i=e.charCodeAt(s);r+=n.charAt(i>>>4&15)+n.charAt(i&15)}return r}function _(e){try{E}catch(t){E=""}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var r="";var i=e.length;for(var s=0;s<i;s+=3){var o=e.charCodeAt(s)<<16|(s+1<i?e.charCodeAt(s+1)<<8:0)|(s+2<i?e.charCodeAt(s+2):0);for(var u=0;u<4;u++){if(s*8+u*6>e.length*8)r+=E;else r+=n.charAt(o>>>6*(3-u)&63)}}return r}function D(e,t){var n=t.length;var r=Array();var i,s,o,u;var a=Array(Math.ceil(e.length/2));for(i=0;i<a.length;i++){a[i]=e.charCodeAt(i*2)<<8|e.charCodeAt(i*2+1)}while(a.length>0){u=Array();o=0;for(i=0;i<a.length;i++){o=(o<<16)+a[i];s=Math.floor(o/n);o-=s*n;if(u.length>0||s>0)u[u.length]=s}r[r.length]=o;a=u}var f="";for(i=r.length-1;i>=0;i--)f+=t.charAt(r[i]);var l=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));for(i=f.length;i<l;i++)f=t[0]+f;return f}function P(e){var t="";var n=-1;var r,i;while(++n<e.length){r=e.charCodeAt(n);i=n+1<e.length?e.charCodeAt(n+1):0;if(55296<=r&&r<=56319&&56320<=i&&i<=57343){r=65536+((r&1023)<<10)+(i&1023);n++}if(r<=127)t+=String.fromCharCode(r);else if(r<=2047)t+=String.fromCharCode(192|r>>>6&31,128|r&63);else if(r<=65535)t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63);else if(r<=2097151)t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63)}return t}function H(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function B(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function j(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<24-n%32;return t}function F(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function I(e,t){e[t>>5]|=128<<24-t%32;e[(t+64>>9<<4)+15]=t;var n=Array(80);var r=1732584193;var i=-271733879;var s=-1732584194;var o=271733878;var u=-1009589776;for(var a=0;a<e.length;a+=16){var f=r;var l=i;var c=s;var h=o;var p=u;for(var d=0;d<80;d++){if(d<16)n[d]=e[a+d];else n[d]=z(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var v=U(U(z(r,5),q(d,i,s,o)),U(U(u,n[d]),R(d)));u=o;o=s;s=z(i,30);i=r;r=v}r=U(r,f);i=U(i,l);s=U(s,c);o=U(o,h);u=U(u,p)}return Array(r,i,s,o,u)}function q(e,t,n,r){if(e<20)return t&n|~t&r;if(e<40)return t^n^r;if(e<60)return t&n|t&r|n&r;return t^n^r}function R(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function U(e,t){var n=(e&65535)+(t&65535);var r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function z(e,t){return e<<t|e>>>32-t}var e={oauthd_url:"{{auth_url}}",oauthd_api:"{{api_url}}",version:"web-0.1.5",options:{}};if(!window.OAuth){if(typeof jQuery=="undefined"){var t=[];var n=document.createElement("script");n.src="//code.jquery.com/jquery.min.js";n.type="text/javascript";n.onload=function(){v(jQuery);for(var e in t)window.OAuth[t[e].method].apply(window.OAuth,t[e].args)};document.getElementsByTagName("head")[0].appendChild(n);var r=["initialize","setOAuthdURL","getVersion","create","popup","redirect","callback","http"];window.OAuth={};var i=function(e){window.OAuth[e]=function(){var n=[];for(var r in arguments)n[r]=arguments[r];t.push({method:e,args:n})}};for(var s in r)i(r[s])}else v(jQuery)}e.oauthd_base=a(e.oauthd_url).match(/^.{2,5}:\/\/[^/]+/)[0];var o=[];var u;(function(){var t=/[\\#&]oauthio=([^&]*)/.exec(document.location.hash);if(t){document.location.hash=document.location.hash.replace(/&?oauthio=[^&]*/,"");u=decodeURIComponent(t[1].replace(/\+/g," "));var n=y("oauthio_state");if(n){o.push(n);b("oauthio_state")}}})();var w=0;var E=""})()